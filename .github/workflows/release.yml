name: Gerar changelog traduzido

on:
  push:
    branches:
      - main

jobs:
  changelog:
    name: Gerar e traduzir changelog
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do código
        uses: actions/checkout@v3

      - name: Instalar Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Instalar Release Please
        run: npm install -g release-please

      - name: Gerar changelog com Release Please
        run: |
          release-please changelog --repo-url=${{ github.repository }} --token=${{ secrets.GITHUB_TOKEN }} > changelog.md

      - name: Traduzir changelog para português
        run: |
          # Remove links de commits
          sed -E 's/\([^)]+\)//g' changelog.md > changelog-no-links.md

          # Traduz usando ferramenta simples (exemplo com translate-shell)
          # Instala translate-shell
          sudo apt-get install translate-shell

          # Traduz linha por linha
          while IFS= read -r line; do
            echo "$(trans -b :pt "$line")" >> tim-log-PT.md
          done < changelog-no-links.md

      - name: Criar Pull Request com tim-log-PT.md
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: "Adiciona changelog traduzido para português"
          branch: changelog-pt
          title: "Changelog traduzido para português"
          body: "Este PR adiciona o changelog traduzido para português no arquivo tim-log-PT.md"
          add-paths: tim-log-PT.md
